<!DOCTYPE html>
<!-- 
Chosen Palette: Dynamic Pastel Palette
Application Structure Plan: The application structure is designed for a dynamic product catalog powered by Google Sheets. It features a header with company name and a cart icon. AI tools are now prominently displayed on the right side as large, image-backed buttons. The main content area dynamically displays categories as colorful tiles and products in a grid. Product details open in a full-screen modal with integrated calculators and contextual AI features. A dedicated cart modal handles order management and includes WhatsApp sharing and professional printing functionalities. This structure prioritizes modularity and dynamic data loading.
Visualization & Content Choices: 
- Report Info: Product Data from Google Sheet -> Goal: Dynamic Loading & Centralized Management -> Viz/Presentation: Fetch JSON from Apps Script, then dynamically create product cards -> Interaction: Products appear after fetch, filters apply to fetched data -> Justification: Allows easy product updates via Google Sheet without touching code, replaces static embedded HTML. -> Library/Method: JavaScript Fetch API.
- Report Info: AI Tools -> Goal: Accessibility & Enhanced UI -> Viz/Presentation: Large, square, rounded buttons with user-defined image backgrounds -> Interaction: Direct access to AI features -> Justification: User requested prominent, stacked buttons with custom backgrounds for branding. -> Library/Method: HTML/CSS (Tailwind) with dynamic `background-image` in JS.
- Report Info: Printing functionality (AI output, Cart) -> Goal: Professional Output -> Viz/Presentation: Print function using a new window/iframe -> Interaction: User triggers print via button -> Justification: Ensures clean, professional prints without interfering with main page layout, preventing blank page issues. -> Library/Method: JavaScript (window.open, document.write).
CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
-->
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×§×˜×œ×•×’ ××•×¦×¨×™× ××©×•×“×¨×’ - ×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ 1994 ×‘×¢"×</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Assistant', sans-serif; 
            background: linear-gradient(to bottom, #e0f2f7, #ffffff); /* Light gradient background */
        }
        .glass-effect {
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
        }
        .ai-button-square {
            width: 100px; /* Fixed width for square button */
            height: 100px; /* Fixed height for square button */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 12px; /* Rounded corners */
            transition: transform 0.2s, box-shadow 0.2s;
            background-size: cover;
            background-position: center;
            color: white; /* Text color for buttons */
            text-shadow: 0 0 5px rgba(0,0,0,0.5); /* Text shadow for readability on image */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            position: relative; /* For icon positioning */
            overflow: hidden; /* Ensure background image fits */
        }
        .ai-button-square span {
            z-index: 1; /* Ensure text/icon is above background */
        }
        .ai-button-square::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3); /* Dark overlay for text readability */
            z-index: 0;
        }
        .ai-button-square:hover {
            transform: translateY(-3px) scale(1.03);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }
        .category-tile:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(0,0,0,0.15);
        }
        /* General print styles */
        @media print {
            body { 
                background: none !important; 
                margin: 0; 
                padding: 0;
            }
            .no-print {
                display: none !important;
            }
        }
        /* Image frame with emoji */
        .emoji-frame {
            position: relative;
            display: inline-block;
            padding: 10px; /* Adjust padding to control emoji spacing */
            border: 2px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .emoji-frame::before {
            content: 'âœ¨'; /* Top-left emoji */
            position: absolute;
            top: -10px;
            left: -10px;
            font-size: 1.5em;
        }
        .emoji-frame::after {
            content: 'ğŸŒŸ'; /* Bottom-right emoji */
            position: absolute;
            bottom: -10px;
            right: -10px;
            font-size: 1.5em;
        }
        .whatsapp-button {
            background-color: #25D366; /* WhatsApp green */
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            border-radius: 9999px; /* Fully rounded */
            font-weight: bold;
            transition: background-color 0.2s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .whatsapp-button:hover {
            background-color: #1DA851;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- Filter Sidebar (Off-canvas) -->
    <aside id="filter-sidebar" class="fixed top-0 left-0 h-full w-80 bg-white shadow-2xl z-50 transform -translate-x-full transition-transform duration-300 ease-in-out no-print">
        <div class="p-6 h-full flex flex-col">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-blue-600">×¡×™× ×•×Ÿ ××ª×§×“×</h3>
                <button id="close-filter-sidebar" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <div class="space-y-4 flex-grow overflow-y-auto pr-2">
                <div>
                    <label for="search-input" class="block text-sm font-medium text-gray-700 mb-1">×—×™×¤×•×© ×©× ××•×¦×¨</label>
                    <input type="text" id="search-input" placeholder="×œ×“×•×’××”: ××œ×˜" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <div>
                    <label for="brand-filter" class="block text-sm font-medium text-gray-700 mb-1">×¡×™× ×•×Ÿ ×œ×¤×™ ××•×ª×’</label>
                    <select id="brand-filter" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">×›×œ ×”××•×ª×’×™×</option>
                    </select>
                </div>
                <div>
                    <label for="type-filter" class="block text-sm font-medium text-gray-700 mb-1">×¡×™× ×•×Ÿ ×œ×¤×™ ×¡×•×’ ××•×¦×¨</label>
                    <select id="type-filter" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">×›×œ ×”×¡×•×’×™×</option>
                    </select>
                </div>
                <div>
                    <label for="department-filter" class="block text-sm font-medium text-gray-700 mb-1">×¡×™× ×•×Ÿ ×œ×¤×™ ××—×œ×§×”</label>
                    <select id="department-filter" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">×›×œ ×”××—×œ×§×•×ª</option>
                    </select>
                </div>
            </div>
            <div class="mt-6">
                <button id="apply-filters-btn" class="w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700 transition-colors">×”×—×œ ×¡×™× ×•×Ÿ</button>
                 <button id="clear-filters-btn" class="w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-md hover:bg-gray-300 transition-colors mt-2">× ×§×” ×”×›×œ</button>
            </div>
        </div>
    </aside>
    <div id="sidebar-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden no-print"></div>

    <!-- Main Content -->
    <div id="main-content" class="transition-transform duration-300 ease-in-out">
        <!-- Header & AI Tools -->
        <header class="sticky top-0 bg-white/80 backdrop-blur-sm shadow-md z-30 p-4 no-print">
            <div class="container mx-auto">
                <div class="flex justify-between items-center">
                    <h1 class="text-2xl font-bold text-blue-600">×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ</h1>
                    <button id="open-cart-btn" class="relative bg-blue-100 text-blue-800 p-2 rounded-full shadow-sm hover:bg-blue-200 transition">
                        ğŸ›’ <span id="cart-counter" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                </div>
            </div>
        </header>

        <main class="container mx-auto p-4 md:p-8">
            <div class="flex flex-col md:flex-row-reverse gap-8">
                <!-- AI Tools Section (Right Side) -->
                <section id="ai-tools-section" class="w-full md:w-1/4 flex flex-col items-end space-y-4 no-print">
                    <h2 class="text-2xl font-bold text-gray-700 mb-4 text-right">×›×œ×™ AI ×œ×©×™×¨×•×ª×š:</h2>
                    <div id="ai-tools-container" class="grid grid-cols-2 gap-4">
                        <!-- AI Tool Buttons will be injected here by JS -->
                    </div>
                </section>

                <!-- Main Product and Category Content (Left/Center) -->
                <div class="w-full md:w-3/4">
                    <!-- Categories Section -->
                    <section id="categories-section" class="mb-12">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-3xl font-bold">×§×˜×’×•×¨×™×•×ª ××•×¦×¨×™×</h2>
                            <button id="advanced-filter-btn" class="flex items-center bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300 transition">
                                <span>×¡×™× ×•×Ÿ ××ª×§×“×</span>
                                <span class="mr-2 text-lg">+</span>
                            </button>
                        </div>
                        <div id="categories-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 md:gap-6">
                            <!-- Category tiles will be injected here -->
                        </div>
                    </section>
                    
                    <!-- Products Section -->
                    <section id="products-section">
                        <div id="products-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                            <!-- Products will be dynamically loaded here from Google Sheet -->
                        </div>
                         <p id="no-results" class="text-center text-gray-500 text-xl hidden py-16">×œ× × ××¦××• ××•×¦×¨×™× ×”×ª×•×××™× ××ª ×”×¡×™× ×•×Ÿ.</p>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- Product Modal (Full Screen) -->
    <div id="product-modal" class="fixed inset-0 z-50 bg-black/50 hidden overflow-y-auto p-4 no-print">
        <div id="modal-content-wrapper" class="relative w-full max-w-5xl min-h-[90vh] my-8 mx-auto rounded-2xl shadow-2xl transition-all duration-300 scale-95 opacity-0">
             <div id="modal-glass-bg" class="absolute inset-0 rounded-2xl glass-effect"></div>
             <div class="relative p-6 md:p-8 text-white h-full flex flex-col">
                <button id="close-modal" class="absolute top-4 right-4 text-white/70 hover:text-white text-3xl font-bold">&times;</button>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 flex-grow">
                    <!-- Left Side: Image & Basic Info -->
                    <div class="flex flex-col items-center text-center">
                        <h2 id="modal-product-name" class="text-4xl font-bold mb-2"></h2>
                        <p id="modal-product-brand" class="text-lg opacity-80 mb-4"></p>
                        <div class="emoji-frame mb-4">
                            <img id="modal-product-image" src="" alt="" class="w-48 h-48 object-contain rounded-lg bg-white/20 p-2">
                        </div>
                        <p id="modal-product-sku" class="text-base text-gray-200 mt-2">××§"×˜: </p>
                        <p id="modal-product-description" class="text-base mt-4"></p>
                        <button id="add-to-cart-btn" class="mt-8 w-full bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition shadow-lg">×”×•×¡×£ ×œ×¢×’×œ×”</button>
                    </div>
                    <!-- Right Side: Calculators & AI Tools -->
                    <div class="flex flex-col space-y-6">
                        <!-- Calculator Area -->
                        <div id="calculator-container" class="bg-white/10 p-4 rounded-lg">
                            <h3 class="text-xl font-bold mb-4">××—×©×‘×•×Ÿ ×—×•××¨×™×</h3>
                            <div id="calculator-content"></div>
                            <p id="calculator-result" class="mt-4 text-lg font-bold bg-white/20 p-2 rounded-md text-center"></p>
                        </div>
                        <!-- AI Tools Area -->
                        <div class="bg-white/10 p-4 rounded-lg flex-grow">
                             <h3 class="text-xl font-bold mb-4">×›×œ×™× ×—×›××™× ×œ××•×¦×¨ ×–×”</h3>
                             <div id="modal-ai-tools-contextual" class="grid grid-cols-2 gap-4">
                                <!-- Contextual AI buttons go here -->
                                <button data-tool="enhanced-description" class="bg-white/20 p-2 rounded-md hover:bg-white/30 transition text-right">×ª×™××•×¨ ×©×™×•×•×§×™ ××©×•×¤×¨</button>
                                <button data-tool="related-products" class="bg-white/20 p-2 rounded-md hover:bg-white/30 transition text-right">××¦× ××•×¦×¨×™× ×§×©×•×¨×™×</button>
                                <button data-tool="problem-solver" class="bg-white/20 p-2 rounded-md hover:bg-white/30 transition text-right">×¢×–×¨×” ×‘×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª</button>
                                <button data-tool="waste-disposal" class="bg-white/20 p-2 rounded-md hover:bg-white/30 transition text-right">×¤×™× ×•×™ ×¤×¡×•×œ×ª ×‘× ×™×™×Ÿ</button>
                             </div>
                             <div id="waste-disposal-tools" class="mt-4 p-3 bg-black/20 rounded-md hidden">
                                <h4 class="font-bold mb-2">×¤×™× ×•×™ ×¤×¡×•×œ×ª:</h4>
                                <div class="space-y-2">
                                    <button data-waste-action="place" class="w-full bg-blue-600 text-white py-2 px-4 rounded-md hover:bg-blue-700 transition">×”×¦×‘×ª ××›×•×œ×”</button>
                                    <button data-waste-action="replace" class="w-full bg-yellow-600 text-white py-2 px-4 rounded-md hover:bg-yellow-700 transition">×”×—×œ×¤×ª ××›×•×œ×”</button>
                                    <button data-waste-action="remove" class="w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 transition">×”×•×¦××ª ××›×•×œ×”</button>
                                </div>
                             </div>
                             <div id="modal-ai-output" class="mt-4 p-3 bg-black/20 rounded-md h-32 overflow-y-auto hidden"></div>
                             <button id="print-ai-output-btn" class="mt-4 w-full bg-blue-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-600 transition shadow-md hidden">×”×“×¤×¡ ×ª×©×•×‘×ª AI</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shopping Cart Modal -->
    <div id="cart-modal" class="fixed inset-0 z-50 bg-black/50 hidden overflow-y-auto p-4 no-print">
        <div id="cart-modal-content-wrapper" class="relative w-full max-w-xl min-h-[50vh] my-8 mx-auto bg-white rounded-2xl shadow-2xl p-6 md:p-8 transform scale-95 opacity-0 transition-all duration-300">
            <button id="close-cart-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-3xl font-bold">&times;</button>
            <h2 class="text-3xl font-bold text-blue-600 mb-6 text-center">×¢×’×œ×ª ×”×§× ×™×•×ª ×©×œ×š</h2>
            <div id="cart-items-container" class="space-y-3 overflow-y-auto max-h-[calc(60vh-180px)] mb-6">
                <!-- Cart items will be loaded here -->
            </div>
            <div id="order-form-container" class="mt-6 p-4 bg-gray-50 rounded-lg">
                <h3 class="text-xl font-bold text-gray-700 mb-4">×¤×¨×˜×™ ×”×–×× ×” ×•××¡×¤×§×”</h3>
                <div class="space-y-3">
                    <input type="text" id="customer-name" placeholder="×©× ××œ×" class="w-full p-2 border border-gray-300 rounded-md">
                    <input type="tel" id="customer-phone" placeholder="×˜×œ×¤×•×Ÿ" class="w-full p-2 border border-gray-300 rounded-md">
                    <input type="email" id="customer-email" placeholder="××™××™×™×œ (××•×¤×¦×™×•× ×œ×™)" class="w-full p-2 border border-gray-300 rounded-md">
                    <input type="text" id="delivery-address" placeholder="×›×ª×•×‘×ª ×œ××¡×¤×§×”" class="w-full p-2 border border-gray-300 rounded-md">
                    <select id="delivery-type" class="w-full p-2 border border-gray-300 rounded-md">
                        <option value="">×‘×—×¨ ×¡×•×’ ×”×•×‘×œ×”</option>
                        <option value="manual">×¤×¨×™×§×” ×™×“× ×™×ª</option>
                        <option value="crane-10m">×¤×¨×™×§×ª ×× ×•×£ 10 ××˜×¨</option>
                        <option value="crane-15m">×¤×¨×™×§×ª ×× ×•×£ 15 ××˜×¨</option>
                        <option value="crane-30m">×¤×¨×™×§×ª ×× ×•×£ 30 ××˜×¨</option>
                    </select>
                    <textarea id="order-notes" placeholder="×”×¢×¨×•×ª ×œ×”×–×× ×” (××•×¤×¦×™×•× ×œ×™)" class="w-full p-2 border border-gray-300 rounded-md h-20 resize-y"></textarea>
                </div>
            </div>
            <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
                <button id="whatsapp-share-btn" class="flex-grow bg-green-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-green-600 transition shadow-md whatsapp-button">
                    <span class="ml-2">×©×œ×— ×”×–×× ×” ×‘-WhatsApp</span> ğŸ’¬
                </button>
                <button id="print-order-btn" class="flex-grow bg-blue-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-600 transition shadow-md">
                    <span class="ml-2">×”×“×¤×¡ ×”×–×× ×”</span> ğŸ–¨ï¸
                </button>
                <button id="clear-cart-btn" class="flex-grow bg-red-500 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-600 transition shadow-md">
                    <span class="ml-2">× ×§×” ×¢×’×œ×”</span> ğŸ—‘ï¸
                </button>
            </div>
        </div>
    </div>

    <script>
        // *** ×”×’×“×¨×•×ª ×—×©×•×‘×•×ª ***
        // ×”×—×œ×£ ×‘×›×ª×•×‘×ª ×”-URL ×©×œ ×¤×¨×™×¡×ª ×”-Apps Script ×©×œ×š. ×•×•×“× ×©×”×§×™×©×•×¨ × ××¦× ×‘×ª×•×š ×’×¨×©×™×™× ×‘×•×“×“×™× ('...').
        // ×œ×“×•×’××”: 'https://script.google.com/macros/s/abcdefg1234567890/exec'
        const APPS_SCRIPT_WEB_APP_URL = 'AKfycbyzdkvb4wOMILaPIq-oalk6IRA7UKxCfcsRYW0VPjF5LHO3qYLewgicT8Ua6GCdQnTn'; 
        // ×”×—×œ×£ ×‘××–×”×” ×”×’×™×œ×™×•×Ÿ ×©×œ×š ×‘-Google Sheets. ×•×•×“× ×©×”××–×”×” × ××¦× ×‘×ª×•×š ×’×¨×©×™×™× ×‘×•×“×“×™× ('...').
        // ×œ×“×•×’××”: '1A2B3C4D5E6F7G8H9I0J'
        const SPREADSHEET_ID = '1e9gAjJA4e1MY4pATx1wVsx1IJZoD4jzKkcnHRvZKv5s'; 
        // ××¡×¤×¨ ×•×•××˜×¡××¤ ×œ×©×™×ª×•×£
        const whatsappNumber = '972508860896'; 
        // ××¤×ª×— API ×¢×‘×•×¨ Gemini (××™×Ÿ ×¦×•×¨×š ×œ×”×–×™×Ÿ - Canvas ××¡×¤×§ ××•×˜×•××˜×™×ª)
        const apiKey = "AIzaSyCNn7GZMsQPCdRSfgz_o08M1YV63CkA3Ow
"; 
        const GEMINI_API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
        // *********************

        document.addEventListener('DOMContentLoaded', () => {
            let allProducts = [];
            let cart = []; // ×’×œ×•×‘×œ×™ ×œ×¢×’×œ×”

            // ×”×’×“×¨×ª ×›×œ×™ ×”-AI ×¢× ××™×™×§×•× ×™× ×•×§×™×©×•×¨×™ ×ª××•× ×•×ª
            const aiTools = [
                { id: 'project-planner', name: '×¢×•×–×¨ ×ª×›× ×•×Ÿ ×¤×¨×•×™×§×˜×™×', icon: 'ğŸ‘·', imageUrl: 'https://placehold.co/100x100/2196F3/FFFFFF?text=×ª×›× ×•×Ÿ' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'material-calculator', name: '××—×©×‘×•×Ÿ ×—×•××¨×™×', icon: 'ï¿½', imageUrl: 'https://placehold.co/100x100/4CAF50/FFFFFF?text=××—×©×‘×•×Ÿ' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'compare-products', name: '×”×©×•×•××ª ××•×¦×¨×™×', icon: 'âš–ï¸', imageUrl: 'https://placehold.co/100x100/FFC107/FFFFFF?text=×”×©×•×•××”' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'order-assistant', name: '×¢×•×–×¨ ×”×–×× ×”', icon: 'ğŸ›’', imageUrl: 'https://placehold.co/100x100/9C27B0/FFFFFF?text=×”×–×× ×”' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'problem-solver', name: '×¤×ª×¨×•×Ÿ ×‘×¢×™×•×ª', icon: 'ğŸ› ï¸', imageUrl: 'https://placehold.co/100x100/FF5722/FFFFFF?text=×‘×¢×™×•×ª' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'alternative-products', name: '×”×¦×¢×ª ×—×œ×•×¤×•×ª', icon: 'ğŸ’¡', imageUrl: 'https://placehold.co/100x100/00BCD4/FFFFFF?text=×—×œ×•×¤×•×ª' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'pro-assistant', name: '×¢×•×–×¨ ××§×¦×•×¢×™', icon: 'ğŸ§‘â€ğŸ”§', imageUrl: 'https://placehold.co/100x100/8BC34A/FFFFFF?text=××§×¦×•×¢×™' }, // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
                { id: 'q-and-a', name: '×©××œ×•×ª ×•×ª×©×•×‘×•×ª', icon: 'ğŸ’¬', imageUrl: 'https://placehold.co/100x100/607D8B/FFFFFF?text=×©××œ×•×ª' } // ×”×—×œ×£ ×‘×§×™×©×•×¨ ×©×œ×š
            ];

            // ××œ×× ×˜×™× ××¨×›×–×™×™× ×‘-DOM
            const productsContainer = document.getElementById('products-container');
            const categoriesGrid = document.getElementById('categories-grid');
            const aiToolsContainer = document.getElementById('ai-tools-container');
            const noResults = document.getElementById('no-results');

            // --- ××œ×× ×˜×™× ×©×œ ××•×“××œ ×”××•×¦×¨ ---
            const productModal = document.getElementById('product-modal');
            const modalContentWrapper = document.getElementById('modal-content-wrapper');
            const modalGlassBg = document.getElementById('modal-glass-bg');
            const closeModalBtn = document.getElementById('close-modal');
            const addToCartBtn = document.getElementById('add-to-cart-btn');
            const printAiOutputBtn = document.getElementById('print-ai-output-btn'); // ×›×¤×ª×•×¨ ×”×“×¤×¡×” ×—×“×© ×œ×ª×©×•×‘×ª AI
            const modalAiToolsContextual = document.getElementById('modal-ai-tools-contextual'); // ×›×¤×ª×•×¨×™ AI ×‘×ª×•×š ×”××•×“××œ
            const wasteDisposalTools = document.getElementById('waste-disposal-tools'); // ×›×œ×™ ×¤×™× ×•×™ ×¤×¡×•×œ×ª

            // --- ××œ×× ×˜×™× ×©×œ ××•×“××œ ×¢×’×œ×ª ×”×§× ×™×•×ª ---
            const cartModal = document.getElementById('cart-modal');
            const cartModalContentWrapper = document.getElementById('cart-modal-content-wrapper');
            const openCartBtn = document.getElementById('open-cart-btn');
            const closeCartModalBtn = document.getElementById('close-cart-modal');
            const cartItemsContainer = document.getElementById('cart-items-container');
            const cartCounter = document.getElementById('cart-counter');
            const whatsappShareBtn = document.getElementById('whatsapp-share-btn');
            const printOrderBtn = document.getElementById('print-order-btn');
            const clearCartBtn = document.getElementById('clear-cart-btn');
            const customerNameInput = document.getElementById('customer-name');
            const customerPhoneInput = document.getElementById('customer-phone');
            const customerEmailInput = document.getElementById('customer-email');
            const deliveryAddressInput = document.getElementById('delivery-address');
            const deliveryTypeSelect = document.getElementById('delivery-type');
            const orderNotesInput = document.getElementById('order-notes');

            // --- ××œ×× ×˜×™× ×©×œ ×¡×¨×’×œ ×”×¦×“ (×¤×™×œ×˜×¨×™×) ---
            const filterSidebar = document.getElementById('filter-sidebar');
            const sidebarOverlay = document.getElementById('sidebar-overlay');
            const openFilterBtn = document.getElementById('advanced-filter-btn');
            const closeFilterBtn = document.getElementById('close-filter-sidebar');

            /**
             * ×¤×•× ×§×¦×™×” ×œ×©×œ×™×¤×ª ××•×¦×¨×™× ××’×™×œ×™×•×Ÿ Google Sheets.
             * ××©×ª××©×ª ×‘-Apps Script Web App ×›-API.
             */
            const fetchProductsFromSheet = async () => {
                productsContainer.innerHTML = '<p class="text-center text-blue-600 text-xl py-16">×˜×•×¢×Ÿ ××•×¦×¨×™×... ×× × ×”××ª×Ÿ.</p>';
                try {
                    // ×‘×“×™×§×” ×”×× ×›×ª×•×‘×•×ª ×”-URL ×•×”-ID ×”×•×’×“×¨×• × ×›×•×Ÿ
                    if (APPS_SCRIPT_WEB_APP_URL === 'YOUR_APPS_SCRIPT_URL_HERE' || SPREADSHEET_ID === 'YOUR_SPREADSHEET_ID_HERE') {
                        const errorMessage = `
                            <p class="text-red-500 col-span-full text-center text-lg font-bold">
                                ×©×’×™××”: ×™×© ×œ×”×’×“×™×¨ ××ª ×›×ª×•×‘×ª ×”-URL ×©×œ Apps Script Web App ×•××–×”×” ×”×’×™×œ×™×•×Ÿ.
                            </p>
                            <p class="text-gray-700 text-center mt-2">
                                ×× × ×•×“× ×©×”×§×‘×•×¢×™× <code class="font-mono bg-gray-200 p-1 rounded">APPS_SCRIPT_WEB_APP_URL</code> ×•- <code class="font-mono bg-gray-200 p-1 rounded">SPREADSHEET_ID</code> 
                                ×‘×ª×—×™×œ×ª ×§×•×“ ×”-JavaScript ×”×•×—×œ×¤×• ×‘×¢×¨×›×™× ×”× ×›×•× ×™× ×©×œ×š, ×•×©×”× × ××¦××™× ×‘×ª×•×š ×’×¨×©×™×™× ×‘×•×“×“×™×.
                                (×¤×ª×— ××ª ×”×§×•×“ ×‘-Canvas ×•×—×¤×© ××ª ×”×§×˜×¢ "*** ×”×’×“×¨×•×ª ×—×©×•×‘×•×ª ***").
                            </p>
                        `;
                        productsContainer.innerHTML = errorMessage;
                        console.error('Configuration Error: APPS_SCRIPT_WEB_APP_URL or SPREADSHEET_ID not updated.');
                        return [];
                    }

                    const url = `${APPS_SCRIPT_WEB_APP_URL}?id=${SPREADSHEET_ID}`;
                    console.log('Attempting to fetch from URL:', url); // Log the URL for debugging
                    const response = await fetch(url);
                    if (!response.ok) {
                        const errorText = await response.text();
                        throw new Error(`HTTP error! status: ${response.status}, message: ${errorText}`);
                    }
                    const data = await response.json();
                    if (data.error) throw new Error(data.error); // ×˜×™×¤×•×œ ×‘×©×’×™××•×ª ××”×¡×§×¨×™×¤×˜

                    // ×”××¨×ª ×”× ×ª×•× ×™× ××”×’×™×œ×™×•×Ÿ ×œ×¤×•×¨××˜ ×©×× ×—× ×• ××¦×¤×™× ×œ×•
                    return data.map(item => ({
                        id: item['××§"×˜'] || Math.random().toString(36).substring(2, 11),
                        name: item.title || '×©× ×œ× ×–××™×Ÿ',
                        price: item.price || '××—×™×¨ ×œ× ×–××™×Ÿ',
                        description: item.description || '××™×Ÿ ×ª×™××•×¨ ×–××™×Ÿ.',
                        image: item.image || 'https://placehold.co/400x300/e2e8f0/cbd5e0?text=No+Image',
                        category: item.category || '×§×˜×’×•×¨×™×” ×œ× ×™×“×•×¢×”',
                        // ×××¤×™× ××ª category ×’× ×œ-department ×œ×¦×•×¨×š ×”×¡×™× ×•×Ÿ
                        department: item.category || '××—×œ×§×” ×œ× ×™×“×•×¢×”', 
                        brand: item.brand || '××•×ª×’ ×œ× ×™×“×•×¢',
                        availability: item.availability || '×–××™× ×•×ª ×œ× ×™×“×•×¢×”',
                        sku: item['××§"×˜'] || 'N/A' // ×”×•×¡×¤×ª ××§"×˜ ×œ×¤×¨×˜×™ ×”××•×¦×¨
                    }));
                } catch (error) {
                    console.error("Failed to fetch products from Google Sheet:", error);
                    productsContainer.innerHTML = `<p class="text-red-500 col-span-full text-center">×©×’×™××” ×‘×˜×¢×™× ×ª ××•×¦×¨×™× ××”×’×™×œ×™×•×Ÿ. ×× × ×•×“× ×©×”-URL ×•×”××–×”×” × ×›×•× ×™× ×‘×ª×•×š ×§×•×“ ×”-JavaScript, ×•×©×”×¤×¨×™×¡×” ×©×œ Apps Script ×¤×¢×™×œ×” ×¢× ×”×”×¨×©××•×ª ×”××ª××™××•×ª. ×¤×¨×˜×™ ×”×©×’×™××” ×”××œ××™× ×‘×§×•× ×¡×•×œ ×”×“×¤×“×¤×Ÿ (F12).</p>`;
                    return [];
                }
            };
            
            /**
             * ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×¦×‘×¢ ×¤×¡×˜×œ ××§×¨××™.
             * ××©××©×ª ×œ××¨×™×—×™ ×§×˜×’×•×¨×™×•×ª.
             */
            const generatePastelColor = () => {
                return `hsl(${Math.random() * 360}, 70%, 85%)`;
            };
            
            /**
             * ×¤×•× ×§×¦×™×” ×œ×™×¦×™×¨×ª ×¦×‘×¢ ×¨×§×¢ ×–×›×•×›×™×ª×™ ××§×¨××™.
             * ××©××©×ª ×œ××•×“××œ ×”××•×¦×¨.
             */
            const generateGlassBgColor = () => {
                const hue = Math.random() * 360;
                return `hsla(${hue}, 90%, 55%, 0.3)`;
            };

            /**
             * ×¤×•× ×§×¦×™×” ×œ××›×œ×•×¡ ××¨×™×—×™ ×”×§×˜×’×•×¨×™×•×ª ×‘-DOM.
             * ×ª×™×§×•×Ÿ: ×× ×§×˜×’×•×¨×™×” "×œ× ×™×“×•×¢×”" ××’×™×¢×”, ×œ× ×œ×™×¦×•×¨ ×œ×” ××¨×™×—.
             */
            const populateCategories = (products) => {
                const categories = [...new Set(products.map(p => p.category))].filter(cat => cat && cat !== '×§×˜×’×•×¨×™×” ×œ× ×™×“×•×¢×”'); // Ensure category is not empty or "×œ× ×™×“×•×¢×”"
                categoriesGrid.innerHTML = categories.map(cat => {
                    const color = generatePastelColor();
                    return `
                        <div class="category-tile cursor-pointer p-6 rounded-xl text-center transition duration-300" 
                             style="background-color: ${color};"
                             data-category="${cat}">
                            <h3 class="text-xl font-bold text-gray-800">${cat}</h3>
                        </div>
                    `;
                }).join('');
            };

            /**
             * ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ××•×¦×¨×™× ×‘-DOM.
             * ×™×•×¦×¨×ª ××ª ××œ×× ×˜×™ ×”-HTML ×©×œ ×›×¨×˜×™×¡×™ ×”××•×¦×¨×™× ×‘××•×¤×Ÿ ×“×™× ××™.
             */
            const renderProducts = (productsToRender) => {
                productsContainer.innerHTML = ''; // × ×§×” ××ª ×”××™×›×œ ×œ×¤× ×™ ×¨×™× ×“×•×¨
                if (productsToRender.length === 0) {
                    noResults.classList.remove('hidden');
                } else {
                    noResults.classList.add('hidden');
                    productsToRender.forEach(p => {
                        const productCardHtml = `
                            <div class="product-card bg-white rounded-lg shadow-md p-4 text-center cursor-pointer transform hover:scale-105 transition-transform duration-200" 
                                 data-product-id="${p.id}" 
                                 data-category="${p.category}" 
                                 data-brand="${p.brand}" 
                                 data-type="${p.type}" 
                                 data-department="${p.department}">
                                <img src="${p.image}" alt="${p.name}" class="w-full h-32 object-cover mb-4 rounded" onerror="this.src='https://placehold.co/400x300/e2e8f0/cbd5e0?text=No+Image';">
                                <h3 class="text-lg font-semibold text-gray-800">${p.name}</h3>
                                <p class="text-gray-600 text-sm">${p.description}</p>
                                <div class="mt-4 text-blue-600 font-bold">${p.price} ×©"×—</div>
                            </div>
                        `;
                        productsContainer.insertAdjacentHTML('beforeend', productCardHtml);
                    });
                }
            };

            /**
             * ×¤×•× ×§×¦×™×” ×œ××›×œ×•×¡ ××¤×©×¨×•×™×•×ª ×”×¡×™× ×•×Ÿ (××•×ª×’×™×, ×¡×•×’×™×, ××—×œ×§×•×ª).
             */
            const populateFilters = (products) => {
                const brands = [...new Set(products.map(p => p.brand))].filter(b => b && b !== '××•×ª×’ ×œ× ×™×“×•×¢'); // Ensure brand is not empty or "×œ× ×™×“×•×¢"
                const types = [...new Set(products.map(p => p.type))].filter(t => t && t !== '×¡×•×’ ×œ× ×™×“×•×¢'); // Ensure type is not empty or "×œ× ×™×“×•×¢"
                const departments = [...new Set(products.map(p => p.department))].filter(d => d && d !== '××—×œ×§×” ×œ× ×™×“×•×¢×”'); // Ensure department is not empty or "×œ× ×™×“×•×¢"

                const brandFilter = document.getElementById('brand-filter');
                brandFilter.innerHTML = '<option value="">×›×œ ×”××•×ª×’×™×</option>' + brands.map(b => `<option value="${b}">${b}</option>`).join('');

                const typeFilter = document.getElementById('type-filter');
                typeFilter.innerHTML = '<option value="">×›×œ ×”×¡×•×’×™×</option>' + types.map(t => `<option value="${t}">${t}</option>`).join('');

                const departmentFilter = document.getElementById('department-filter');
                departmentFilter.innerHTML = '<option value="">×›×œ ×”××—×œ×§×•×ª</option>' + departments.map(d => `<option value="${d}">${d}</option>`).join('');
            };

            /**
             * ×¤×•× ×§×¦×™×” ×œ×”×¤×¢×œ×ª ×”×¡×™× ×•×Ÿ ×¢×œ ×¨×©×™××ª ×”××•×¦×¨×™×.
             */
            const applyFilters = () => {
                const searchTerm = document.getElementById('search-input').value.toLowerCase();
                const selectedBrand = document.getElementById('brand-filter').value;
                const selectedType = document.getElementById('type-filter').value;
                const selectedDepartment = document.getElementById('department-filter').value;

                let filtered = allProducts.filter(p => {
                    const nameMatch = p.name.toLowerCase().includes(searchTerm);
                    const brandMatch = !selectedBrand || p.brand === selectedBrand;
                    const typeMatch = !selectedType || p.type === selectedType;
                    const departmentMatch = !selectedDepartment || p.department === selectedDepartment;
                    return nameMatch && brandMatch && typeMatch && departmentMatch;
                });
                renderProducts(filtered);
                closeSidebar();
            };
            
            /**
             * ×¤×•× ×§×¦×™×” ×œ× ×™×§×•×™ ×›×œ ×”××¡× × ×™×.
             */
            const clearFilters = () => {
                document.getElementById('search-input').value = '';
                document.getElementById('brand-filter').value = '';
                document.getElementById('type-filter').value = '';
                document.getElementById('department-filter').value = '';
                renderProducts(allProducts);
                closeSidebar();
            };

            /**
             * ×¤×•× ×§×¦×™×” ×œ××›×œ×•×¡ ×›×¤×ª×•×¨×™ ×›×œ×™ ×”-AI ×‘×¨××© ×”×“×£.
             */
            const populateAITools = () => {
                aiToolsContainer.innerHTML = aiTools.map(tool => `
                    <button class="ai-button-square relative text-center" 
                            data-tool-id="${tool.id}" 
                            style="background-image: url('${tool.imageUrl}');">
                        <span class="text-xl font-bold">${tool.icon}</span>
                        <span class="text-sm font-semibold mt-1">${tool.name}</span>
                    </button>
                `).join('');
            };
            
            /**
             * ×¤×•× ×§×¦×™×•×ª ×œ×¤×ª×™×—×” ×•×¡×’×™×¨×” ×©×œ ×¡×¨×’×œ ×”×¦×“ (×¤×™×œ×˜×¨×™×).
             */
            const openSidebar = () => {
                filterSidebar.classList.remove('-translate-x-full');
                sidebarOverlay.classList.remove('hidden');
                document.getElementById('main-content').classList.add('md:translate-x-[-10rem]');
            };

            const closeSidebar = () => {
                filterSidebar.classList.add('-translate-x-full');
                sidebarOverlay.classList.add('hidden');
                document.getElementById('main-content').classList.remove('md:translate-x-[-10rem]');
            };
            
            /**
             * ×¤×•× ×§×¦×™×•×ª ×œ×”×¦×’×” ×•×”×¡×ª×¨×” ×©×œ ××•×“××œ ×”××•×¦×¨ ×‘××¡×š ××œ×.
             */
            const showProductModal = (productId) => {
                const product = allProducts.find(p => p.id === productId);
                if (!product) return;

                document.getElementById('modal-product-name').textContent = product.name;
                document.getElementById('modal-product-brand').textContent = `××•×ª×’: ${product.brand}`;
                document.getElementById('modal-product-image').src = product.image;
                document.getElementById('modal-product-image').alt = product.name;
                document.getElementById('modal-product-sku').textContent = `××§"×˜: ${product.sku}`; // ×”×¦×’×ª ××§"×˜
                document.getElementById('modal-product-description').textContent = product.description;
                addToCartBtn.dataset.productId = product.id; // Store product ID for adding to cart

                modalGlassBg.style.backgroundColor = generateGlassBgColor();

                renderCalculatorForProduct(product);
                
                document.getElementById('modal-ai-output').classList.add('hidden');
                printAiOutputBtn.classList.add('hidden'); // ×”×¡×ª×¨ ×›×¤×ª×•×¨ ×”×“×¤×¡×” ×©×œ AI ×‘×”×ª×—×œ×”
                wasteDisposalTools.classList.add('hidden'); // ×”×¡×ª×¨ ×›×œ×™ ×¤×™× ×•×™ ×¤×¡×•×œ×ª ×‘×”×ª×—×œ×”

                productModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContentWrapper.classList.remove('scale-95', 'opacity-0');
                }, 10);
            };
            
            const hideProductModal = () => {
                modalContentWrapper.classList.add('scale-95', 'opacity-0');
                 setTimeout(() => {
                    productModal.classList.add('hidden');
                 }, 300);
            };
            
            /**
             * ×¤×•× ×§×¦×™×” ×œ×¨×™× ×“×•×¨ ×”××—×©×‘×•×Ÿ ×”××ª××™× ×‘×ª×•×š ××•×“××œ ×”××•×¦×¨, ×‘×”×ª×× ×œ×¡×•×’ ×”××•×¦×¨.
             */
            const renderCalculatorForProduct = (product) => {
                const container = document.getElementById('calculator-content');
                const resultEl = document.getElementById('calculator-result');
                container.innerHTML = '';
                resultEl.textContent = '';
                let calculatorType = 'none';

                if (product.type && (product.type.includes('×‘×œ×•×§') || product.type.includes('×œ×‘× ×™×'))) {
                    calculatorType = 'blocks';
                    container.innerHTML = `
                        <p class="text-sm opacity-80 mb-2">×—×©×‘ ×›××•×ª ×‘×œ×•×§×™× ×œ×§×™×¨</p>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="calc-length" placeholder="××•×¨×š ×”×§×™×¨ (×')" class="p-2 rounded bg-white/20 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white">
                            <input type="number" id="calc-height" placeholder="×’×•×‘×” ×”×§×™×¨ (×')" class="p-2 rounded bg-white/20 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white">
                        </div>
                        <button id="calc-btn" class="w-full mt-2 bg-white/30 p-2 rounded hover:bg-white/40 transition">×—×©×‘</button>
                    `;
                } else if (product.type && product.type.includes('×¦×‘×¢')) {
                    calculatorType = 'paint';
                    container.innerHTML = `
                         <p class="text-sm opacity-80 mb-2">×—×©×‘ ×›××•×ª ×¦×‘×¢ × ×“×¨×©×ª</p>
                        <input type="number" id="calc-area" placeholder="×©×˜×— ×œ×¦×‘×™×¢×” (×'×¨)" class="w-full p-2 rounded bg-white/20 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white">
                        <button id="calc-btn" class="w-full mt-2 bg-white/30 p-2 rounded hover:bg-white/40 transition">×—×©×‘</button>
                    `;
                } else if (product.type && (product.type.includes('×‘×˜×•×Ÿ') || product.type.includes('××œ×˜'))) {
                     calculatorType = 'volume';
                     container.innerHTML = `
                         <p class="text-sm opacity-80 mb-2">×—×©×‘ × ×¤×— × ×“×¨×©</p>
                         <div class="grid grid-cols-3 gap-2">
                             <input type="number" id="calc-length" placeholder="××•×¨×š (×')" class="p-2 rounded bg-white/20 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white">
                             <input type="number" id="calc-width" placeholder="×¨×•×—×‘ (×')" class="p-2 rounded bg-white/20 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white">
                             <input type="number" id="calc-depth" placeholder="×¢×•××§ (×')" class="p-2 rounded bg-white/20 placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-white">
                         </div>
                         <button id="calc-btn" class="w-full mt-2 bg-white/30 p-2 rounded hover:bg-white/40 transition">×—×©×‘</button>
                     `;
                } else {
                     container.innerHTML = `<p class="text-center opacity-70">××™×Ÿ ××—×©×‘×•×Ÿ ×–××™×Ÿ ×¢×‘×•×¨ ××•×¦×¨ ×–×”.</p>`;
                }

                const calcBtn = document.getElementById('calc-btn');
                if(calcBtn) {
                    calcBtn.addEventListener('click', () => {
                        let resultText = '×™×© ×œ×”×–×™×Ÿ ×¢×¨×›×™× ×ª×§×™× ×™×.';
                        try {
                            if (calculatorType === 'blocks') {
                                const length = parseFloat(document.getElementById('calc-length').value);
                                const height = parseFloat(document.getElementById('calc-height').value);
                                if(isNaN(length) || isNaN(height) || length <= 0 || height <= 0) throw new Error();
                                const area = length * height;
                                const blocks = Math.ceil(area * 12.5); // Standard assumption for blocks per sqm
                                resultText = `× ×“×¨×©×™× ×›-${blocks} ×‘×œ×•×§×™× ×¢×‘×•×¨ ${area.toFixed(2)} ×"×¨.`;
                            } else if (calculatorType === 'paint') {
                                const area = parseFloat(document.getElementById('calc-area').value);
                                if(isNaN(area) || area <= 0) throw new Error();
                                const liters = Math.ceil(area / 10); // Standard assumption 10sqm/liter
                                resultText = `× ×“×¨×©×™× ×›-${liters} ×œ×™×˜×¨ ×¦×‘×¢.`;
                            } else if (calculatorType === 'volume') {
                                const length = parseFloat(document.getElementById('calc-length').value);
                                const width = parseFloat(document.getElementById('calc-width').value);
                                const depth = parseFloat(document.getElementById('calc-depth').value);
                                if(isNaN(length) || isNaN(width) || isNaN(depth) || length <= 0 || width <= 0 || depth <= 0) throw new Error();
                                const volume = (length * width * depth).toFixed(3);
                                resultText = `×”× ×¤×— ×”× ×“×¨×© ×”×•× ${volume} ××˜×¨ ×§×•×‘.`;
                            }
                        } catch(e) { /* use default error message */ }
                        resultEl.textContent = resultText;
                    });
                }
            };
            
            /**
             * ×¤×•× ×§×¦×™×” ×œ×˜×™×¤×•×œ ×‘×›×œ×™ ×”-AI ×‘×ª×•×š ××•×“××œ ×”××•×¦×¨.
             * ××‘×¦×¢×ª ×§×¨×™××ª API ×œ××•×“×œ Gemini ×•××¦×™×’×” ××ª ×”×ª×©×•×‘×”.
             */
            const handleModalAITool = async (tool, product) => { // ×”×¤×•× ×§×¦×™×” ×”×¤×›×” ×œ-async
                const outputEl = document.getElementById('modal-ai-output');
                outputEl.classList.add('hidden'); // ×”×¡×ª×¨ ×§×•×“×
                wasteDisposalTools.classList.add('hidden'); // ×”×¡×ª×¨ ×›×œ×™ ×¤×™× ×•×™ ×¤×¡×•×œ×ª
                printAiOutputBtn.classList.add('hidden'); // ×”×¡×ª×¨ ×›×¤×ª×•×¨ ×”×“×¤×¡×” ×©×œ AI

                if (tool === 'waste-disposal') {
                    wasteDisposalTools.classList.remove('hidden');
                    return; // ××™×Ÿ ×¦×•×¨×š ×œ×”×¦×™×’ outputEl ×¢×‘×•×¨ ×–×”
                }

                outputEl.classList.remove('hidden');
                printAiOutputBtn.classList.remove('hidden'); // ×”×¦×’ ×›×¤×ª×•×¨ ×”×“×¤×¡×” ×©×œ AI
                outputEl.innerHTML = '<p class="animate-pulse">×—×•×©×‘... ğŸ§ </p>'; // ×”×•×“×¢×ª ×˜×¢×™× ×”

                let promptText = '';
                switch(tool) {
                    case 'enhanced-description':
                        promptText = `×›×ª×•×‘ ×ª×™××•×¨ ×©×™×•×•×§×™ ××©×•×¤×¨ ×¢×‘×•×¨ ×”××•×¦×¨ ×”×‘×, ×”××ª××™× ×œ×§×˜×œ×•×’ ××•×¦×¨×™× ×œ×—×•××¨×™ ×‘× ×™×™×Ÿ:
                        ×©× ×”××•×¦×¨: ${product.name}
                        ××•×ª×’: ${product.brand}
                        ×ª×™××•×¨ ×§×™×™×: ${product.description}
                        ×”×“×’×© ×™×ª×¨×•× ×•×ª, ××™×›×•×ª ×•×©×™××•×©×™× × ×¤×•×¦×™×. ×”×ª×©×•×‘×” ×¦×¨×™×›×” ×œ×”×™×•×ª ×‘×¢×‘×¨×™×ª.`;
                        break;
                    case 'related-products':
                        promptText = `×× ×™ ××—×¤×© ××•×¦×¨×™× ×§×©×•×¨×™× ×œ××•×¦×¨ ×”×‘× ×‘×§×˜×œ×•×’ ×—×•××¨×™ ×‘× ×™×™×Ÿ:
                        ×©× ×”××•×¦×¨: ${product.name}
                        ×ª×™××•×¨: ${product.description}
                        ×§×˜×’×•×¨×™×”: ${product.category}
                        ×”×¦×¢ 3-5 ××•×¦×¨×™× ×¨×œ×•×•× ×˜×™×™× ×©×™×›×•×œ×™× ×œ×”×©×œ×™× ××• ×œ×”×™×•×ª ×ª×—×œ×™×£, ×•×”×¡×‘×¨ ×‘×§×¦×¨×” ××“×•×¢ ×›×œ ××—×“ ×§×©×•×¨. ×”×ª×©×•×‘×” ×¦×¨×™×›×” ×œ×”×™×•×ª ×‘×¢×‘×¨×™×ª.`;
                        break;
                    case 'problem-solver':
                        promptText = `××”×Ÿ ×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×©×™×›×•×œ×•×ª ×œ×”×ª×¢×•×¨×¨ ×¢× ×©×™××•×© ×‘××•×¦×¨ ×”×‘× ×‘×ª×—×•× ×”×‘× ×™×™×”, ×•×›×™×¦×“ × ×™×ª×Ÿ ×œ×¤×ª×•×¨ ××•×ª×Ÿ?
                        ×©× ×”××•×¦×¨: ${product.name}
                        ×ª×™××•×¨: ${product.description}
                        ×¡×•×’: ${product.type}
                        ×”×¦×’ 3-4 ×‘×¢×™×•×ª × ×¤×•×¦×•×ª ×•×¤×ª×¨×•× ×•×ª ×§×¦×¨×™× ×œ×›×œ ××—×ª. ×”×ª×©×•×‘×” ×¦×¨×™×›×” ×œ×”×™×•×ª ×‘×¢×‘×¨×™×ª.`;
                        break;
                    default:
                        outputEl.innerHTML = '<p class="text-red-400">×›×œ×™ AI ×–×” ××™× ×• × ×ª××š ×›×¨×’×¢.</p>';
                        return;
                }

                try {
                    const chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: promptText }] });
                    const payload = { contents: chatHistory };

                    const response = await fetch(GEMINI_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        console.error('Gemini API Error:', errorData);
                        outputEl.innerHTML = `<p class="text-red-400">×©×’×™××ª API: ${errorData.error.message || response.statusText}</p>`;
                        return;
                    }

                    const result = await response.json();
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        outputEl.innerHTML = text;
                    } else {
                        outputEl.innerHTML = '<p class="text-yellow-400">×œ× ×”×ª×§×‘×œ×” ×ª×©×•×‘×” ××•×‘× ×™×ª ××”-AI.</p>';
                    }
                } catch (error) {
                    console.error('Error calling Gemini API:', error);
                    outputEl.innerHTML = `<p class="text-red-400">×©×’×™××” ×‘×ª×§×©×•×¨×ª ×¢× ×©×™×¨×•×ª×™ ×”-AI: ${error.message}</p>`;
                }
            };

            // --- ×¤×•× ×§×¦×™×•×ª ×¢×’×œ×ª ×§× ×™×•×ª ---
            /**
             * ××•×¡×™×¤×” ××•×¦×¨ ×œ×¢×’×œ×ª ×”×§× ×™×•×ª ×•××¢×“×›× ×ª ××ª ×”×ª×¦×•×’×”.
             */
            const addProductToCart = (productId) => {
                const product = allProducts.find(p => p.id === productId);
                if (product) {
                    cart.push(product);
                    updateCartDisplay();
                    alert(`×”××•×¦×¨ "${product.name}" × ×•×¡×£ ×œ×¢×’×œ×”!`);
                    openCartModal(); // ×¤×•×ª×— ××ª ×¢×’×œ×ª ×”×§× ×™×•×ª ×œ×”×©×œ××ª ×”×”×–×× ×”
                    hideProductModal(); // ×¡×•×’×¨ ××ª ××•×“××œ ×”××•×¦×¨
                }
            };

            /**
             * ××¢×“×›× ×ª ××ª ×ª×¦×•×’×ª ×¢×’×œ×ª ×”×§× ×™×•×ª ×•××ª ××•× ×” ×”×¤×¨×™×˜×™×.
             */
            const updateCartDisplay = () => {
                if (!cartItemsContainer) return; // Ensure element exists

                if (cart.length === 0) {
                    cartItemsContainer.innerHTML = '<p class="text-gray-600 text-center">×¢×’×œ×ª ×”×§× ×™×•×ª ×¨×™×§×”.</p>';
                    document.getElementById('order-form-container').classList.add('hidden'); // ×”×¡×ª×¨ ×˜×•×¤×¡ ×× ×¢×’×œ×” ×¨×™×§×”
                } else {
                    cartItemsContainer.innerHTML = cart.map((item, index) => `
                        <div class="flex justify-between items-center bg-blue-50 p-3 rounded-md shadow-sm">
                            <span class="text-blue-800 font-medium">${index + 1}. ${item.name} (××§"×˜: ${item.sku || 'N/A'})</span>
                            <button class="text-red-500 hover:text-red-700 font-bold text-lg" data-cart-index="${index}">&times;</button>
                        </div>
                    `).join('');
                    document.getElementById('order-form-container').classList.remove('hidden'); // ×”×¦×’ ×˜×•×¤×¡ ×× ×™×© ×¤×¨×™×˜×™×
                }
                cartCounter.textContent = cart.length;
            };

            /**
             * ××¡×™×¨×” ×¤×¨×™×˜ ××¢×’×œ×ª ×”×§× ×™×•×ª ×œ×¤×™ ××™× ×“×§×¡.
             */
            const removeFromCart = (index) => {
                cart.splice(index, 1);
                updateCartDisplay();
            };

            /**
             * ×× ×§×” ××ª ×›×œ ×¢×’×œ×ª ×”×§× ×™×•×ª.
             */
            const clearCart = () => {
                cart = [];
                updateCartDisplay();
                alert('×”×¢×’×œ×” × ×•×§×ª×” ×‘×”×¦×œ×—×”!');
                // × ×§×” ×’× ××ª ×¤×¨×˜×™ ×”×˜×•×¤×¡
                customerNameInput.value = '';
                customerPhoneInput.value = '';
                customerEmailInput.value = '';
                deliveryAddressInput.value = '';
                deliveryTypeSelect.value = '';
                orderNotesInput.value = '';
            };

            /**
             * ×™×•×¦×¨×ª ×”×•×“×¢×ª WhatsApp ××¤×•×¨××˜×ª ××¤×¨×™×˜×™ ×”×¢×’×œ×” ×•×¤×¨×˜×™ ×”×”×–×× ×”.
             */
            const getWhatsAppMessage = () => {
                if (cart.length === 0) {
                    return '×¢×’×œ×ª ×”×§× ×™×•×ª ×¨×™×§×”.';
                }
                const customerName = customerNameInput.value.trim();
                const customerPhone = customerPhoneInput.value.trim();
                const customerEmail = customerEmailInput.value.trim();
                const deliveryAddress = deliveryAddressInput.value.trim();
                const deliveryType = deliveryTypeSelect.value;
                const orderNotes = orderNotesInput.value.trim();

                let message = '×©×œ×•×, ×‘×¨×¦×•× ×™ ×œ×‘×¦×¢ ×”×–×× ×” ×-"×—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ 1994 ×‘×¢"×".\n\n';
                
                if (customerName) message += `×©×: ${customerName}\n`;
                if (customerPhone) message += `×˜×œ×¤×•×Ÿ: ${customerPhone}\n`;
                if (customerEmail) message += `××™××™×™×œ: ${customerEmail}\n`;
                if (deliveryAddress) message += `×›×ª×•×‘×ª ××¡×¤×§×”: ${deliveryAddress}\n`;
                if (deliveryType) message += `×¡×•×’ ×”×•×‘×œ×”: ${deliveryTypeSelect.options[deliveryTypeSelect.selectedIndex].text}\n`;
                if (orderNotes) message += `×”×¢×¨×•×ª: ${orderNotes}\n`;
                
                message += '\n×¤×¨×˜×™ ×”×”×–×× ×” ×©×œ×™:\n';
                cart.forEach((item, index) => {
                    message += `${index + 1}. ${item.name} (××§"×˜: ${item.sku || 'N/A'})\n`;
                });
                message += `\n×¡×”"×› ${cart.length} ×¤×¨×™×˜×™×.\n`;
                message += '××•×“×” ×œ×›× ×¢×œ ×™×¦×™×¨×ª ×§×©×¨ ×œ×ª×™××•× ×”×¤×¨×˜×™× ×”×¡×•×¤×™×™×.';
                return encodeURIComponent(message);
            };

            /**
             * ××©×ª×¤×ª ××ª ×”×”×–×× ×” ×‘-WhatsApp.
             */
            const shareOrderOnWhatsApp = () => {
                if (cart.length === 0) {
                    alert('×¢×’×œ×ª ×”×§× ×™×•×ª ×¨×™×§×” ××›×“×™ ×œ×©×ª×£.');
                    return;
                }
                const message = getWhatsAppMessage();
                const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${message}`;
                window.open(whatsappUrl, '_blank');
            };

            // ×¤×•× ×§×¦×™×™×ª ×”×“×¤×¡×” ×›×œ×œ×™×ª ×•××§×¦×•×¢×™×ª
            const printContent = (contentHtml, title = '××¡××š ×œ×”×“×¤×¡×”') => {
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <!DOCTYPE html>
                    <html lang="he" dir="rtl">
                    <head>
                        <meta charset="UTF-8">
                        <meta name="viewport" content="width=device-width, initial-scale=1.0">
                        <title>${title}</title>
                        <link rel="preconnect" href="https://fonts.googleapis.com">
                        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                        <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
                        <style>
                            body { 
                                font-family: 'Assistant', sans-serif; 
                                margin: 20mm; 
                                color: black; 
                                direction: rtl;
                                background: none;
                            }
                            h2 {
                                text-align: center;
                                margin-bottom: 25px;
                                font-size: 16pt;
                                font-weight: bold;
                                color: #222;
                            }
                            ul {
                                list-style-type: none;
                                padding: 0;
                                margin-top: 20px;
                            }
                            li {
                                margin-bottom: 10px;
                                padding-bottom: 5px;
                                border-bottom: 1px dotted #ccc;
                                font-size: 11pt;
                                line-height: 1.6;
                            }
                            p {
                                margin-bottom: 10px;
                            }
                            strong {
                                font-weight: bold;
                            }
                        </style>
                    </head>
                    <body>
                        <h2>${title}</h2>
                        ${contentHtml}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                printWindow.print();
                printWindow.close();
            };


            // --- ×××–×™× ×™ ××™×¨×•×¢×™× ---
            document.body.addEventListener('click', (e) => {
                // ×¤×ª×™×—×ª ××•×“××œ ××•×¦×¨
                const productCard = e.target.closest('.product-card');
                if (productCard) {
                    showProductModal(productCard.dataset.productId);
                }

                // ×¡×™× ×•×Ÿ ×œ×¤×™ ××¨×™×— ×§×˜×’×•×¨×™×”
                const categoryTile = e.target.closest('.category-tile');
                if (categoryTile) {
                    const category = categoryTile.dataset.category;
                    const filtered = allProducts.filter(p => p.category === category);
                    renderProducts(filtered);
                }
                
                 // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×•×ª ×¢×œ ×›×œ×™ AI ×‘×ª×•×š ×”××•×“××œ
                const modalAIToolBtn = e.target.closest('#modal-ai-tools-contextual button');
                if (modalAIToolBtn) {
                    const tool = modalAIToolBtn.dataset.tool;
                    // ×§×‘×œ ××ª ×”××•×¦×¨ ×”× ×•×›×—×™ ×©××•×¦×’ ×‘××•×“××œ
                    const currentProductId = addToCartBtn.dataset.productId;
                    const product = allProducts.find(p => p.id === currentProductId);
                    if(product) {
                        handleModalAITool(tool, product);
                    }
                }

                // ×˜×™×¤×•×œ ×‘×œ×—×™×¦×•×ª ×¢×œ ×›×¤×ª×•×¨×™ ×¤×™× ×•×™ ×¤×¡×•×œ×ª
                const wasteActionButton = e.target.closest('#waste-disposal-tools button');
                if (wasteActionButton) {
                    const action = wasteActionButton.dataset.wasteAction;
                    alert(`×¤×¢×•×œ×ª ×¤×™× ×•×™ ×¤×¡×•×œ×ª: ${action} - ×‘×§×©×” × ×©×œ×—×”. (×”×“××™×” ×‘×œ×‘×“)`);
                    // ×›××Ÿ ×ª×•×›×œ ×œ×©×œ×‘ ×œ×•×’×™×§×” ×œ×©×œ×™×—×ª ×”× ×ª×•× ×™× ×œ×©×¨×ª ××• ×œ×•×•××˜×¡××¤
                }

                // ×”×¡×¨×ª ×¤×¨×™×˜ ××¢×’×œ×”
                if (e.target.dataset.cartIndex !== undefined) {
                    removeFromCart(parseInt(e.target.dataset.cartIndex));
                }
            });
            
            closeModalBtn.addEventListener('click', hideProductModal);
            productModal.addEventListener('click', (e) => {
                if(e.target === productModal) { // ×¡×’×•×¨ ×¨×§ ×‘×œ×—×™×¦×” ×¢×œ ×”×¨×§×¢ ×”×›×”×”
                    hideProductModal();
                }
            });

            // ×××–×™× ×™ ××™×¨×•×¢×™× ×œ×¢×’×œ×ª ×§× ×™×•×ª
            openCartBtn.addEventListener('click', () => {
                openCartModal();
            });
            closeCartModalBtn.addEventListener('click', () => {
                cartModalContentWrapper.classList.add('scale-95', 'opacity-0');
                setTimeout(() => {
                    cartModal.classList.add('hidden');
                }, 300);
            });
            cartModal.addEventListener('click', (e) => {
                if(e.target === cartModal) {
                    cartModalContentWrapper.classList.add('scale-95', 'opacity-0');
                    setTimeout(() => {
                        cartModal.classList.add('hidden');
                    }, 300);
                }
            });

            const openCartModal = () => {
                cartModal.classList.remove('hidden');
                setTimeout(() => {
                    cartModalContentWrapper.classList.remove('scale-95', 'opacity-0');
                }, 10);
                updateCartDisplay();
            };

            // ×›×¤×ª×•×¨ ×”×•×¡×¤×” ×œ×¢×’×œ×” ×‘××•×“××œ ×”××•×¦×¨
            addToCartBtn.addEventListener('click', (e) => {
                const productId = e.currentTarget.dataset.productId;
                addProductToCart(productId);
            });

            whatsappShareBtn.addEventListener('click', shareOrderOnWhatsApp);
            printOrderBtn.addEventListener('click', () => printContent(cartItemsContainer.innerHTML + document.getElementById('order-form-container').innerHTML, '×¡×™×›×•× ×”×–×× ×” ××—.×¡×‘×Ÿ ×—×•××¨×™ ×‘× ×™×™×Ÿ'));
            clearCartBtn.addEventListener('click', clearCart);

            // ×›×¤×ª×•×¨ ×”×“×¤×¡×” ×©×œ ×ª×©×•×‘×ª AI
            printAiOutputBtn.addEventListener('click', () => {
                const aiOutputContent = document.getElementById('modal-ai-output').innerHTML;
                printContent(aiOutputContent, '×ª×©×•×‘×ª AI ×œ××•×¦×¨');
            });


            // ×××–×™× ×™ ××™×¨×•×¢×™× ×œ×¡×¨×’×œ ×”×¦×“ (×¤×™×œ×˜×¨×™×)
            openFilterBtn.addEventListener('click', openSidebar);
            closeFilterBtn.addEventListener('click', closeSidebar);
            sidebarOverlay.addEventListener('click', closeSidebar);
            document.getElementById('apply-filters-btn').addEventListener('click', applyFilters);
            document.getElementById('clear-filters-btn').addEventListener('click', clearFilters);


            // --- ××ª×—×•×œ ×”××¤×œ×™×§×¦×™×” ---
            const init = async () => {
                allProducts = await fetchProductsFromSheet(); // ×©×œ×•×£ ××•×¦×¨×™× ××’×™×œ×™×•×Ÿ Sheets
                
                populateAITools(); // ××›×œ×¡ ×›×¤×ª×•×¨×™ AI ×‘×¨××© ×”×“×£
                
                if(allProducts.length > 0) {
                    populateCategories(allProducts);
                    populateFilters(allProducts);
                    renderProducts(allProducts); // ×¨× ×“×¨ ××ª ×›×œ ×”××•×¦×¨×™× ×‘×”×ª×—×œ×”
                } else {
                    // ×”×•×“×¢×” ×–×• ×ª×•×¤×™×¢ ×¨×§ ×× fetchProductsFromSheet ×”×—×–×™×¨ ××¢×¨×š ×¨×™×§ ×•×œ× ×‘×’×œ×œ ×‘×¢×™×™×ª ×§×•× ×¤×™×’×•×¨×¦×™×”
                    if (!document.getElementById('products-container').innerHTML.includes('×©×’×™××”: ×™×© ×œ×”×’×“×™×¨ ××ª ×›×ª×•×‘×ª ×”-URL')) {
                        productsContainer.innerHTML = `<p class="text-red-500 col-span-full text-center">×œ× ×”×¦×œ×—× ×• ×œ×—×œ×¥ ××•×¦×¨×™× ××’×™×œ×™×•×Ÿ ×”-Google Sheets. ×•×“× ×©×”×’×™×œ×™×•×Ÿ ××›×™×œ × ×ª×•× ×™× ×•×©×’×™×œ×™×•×Ÿ ×”-Apps Script ×¤×¨×•×¡ ×›×”×œ×›×”.</p>`;
                    }
                }
                updateCartDisplay(); // ××ª×—×œ ×ª×¦×•×’×ª ×¢×’×œ×” ×¢× 0 ×¤×¨×™×˜×™×
            };

            init();
        });
    </script>
</body>
</html>
ï¿½
